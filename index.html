<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>
	<h3> Where are you working today ? </h3>
	<h4 id="workingAreaText"> Selected Working Area: </h4>
		<div id="container">
			<img  id="workingArea" src="workingArea.png" alt="Working Area logo">
			<img  id="meetingArea" src="star.gif" alt="Meeting Area logo">
			<img id="background" src="firstFloor.png" alt="floorplan image">
			<canvas id="firstFloorCanvas" width="807" height="869"></canvas>
			<img id="transparentImg" src="transparent.png" alt="transparent image" usemap="#image-map">
			<map name="image-map">
				<!-- Working Spaces -->
				<area target="" alt="DeskGroup1" title="DeskGroup1" href="" coords="575,210,642,258" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="DeskGroup2" title="DeskGroup2" href="" coords="575,260,642,310" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="DeskGroup3" title="DeskGroup3" href="" coords="575,310,642,361" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="Office1" title="Office1" href="" coords="608,380,650,424" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="HR" title="HR" href="" coords="438,513,517,586" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="Office2" title="Office2" href="" coords="607,425,649,469" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="DeskGroup4" title="DeskGroup4" href="" coords="575,488,643,540" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="DeskGroup5" title="DeskGroup5" href="" coords="575,542,643,590" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="DeskGroup6" title="DeskGroup6" href="" coords="575,593,644,645" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="DeskGroup7" title="DeskGroup7" href="" coords="575,646,642,696" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="DeskGroup8" title="DeskGroup8" href="" coords="440,617,512,757" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="Reception" title="Reception" href="" coords="284,212,319,258" shape="rect" onClick="setWorkingArea(this); return false;">
				<area target="" alt="Office3" title="Office3" href="" coords="361,207,407,260" shape="rect" onClick="setWorkingArea(this); return false;">
				
				<!-- Meeting Rooms -->
				<area target="" alt="Canteen" title="Canteen" href="" coords="87,321,258,427" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="SeamusHeaney" title="SeamusHeaney" href="" coords="570,700,648,747" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="JonathonSwift" title="JonathonSwift" href="" coords="434,438,471,490" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="OscarWilde" title="OscarWilde" href="" coords="569,381,605,422" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="SeanOCasey" title="SeanOCasey" href="" coords="570,428,606,469" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="SamuelBeckett" title="SamuelBeckett" href="" coords="481,207,541,261" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="JamesJoyce" title="JamesJoyce" href="" coords="409,208,477,260" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="TPGroundFloor" title="TPGroundFloor" href="" coords="218,207,279,296" shape="rect" onClick="drawLineToMeeting(this); return false;">
				<area target="" alt="WBYeats" title="WBYeats" href="" coords="475,437,542,487" shape="rect" onClick="drawLineToMeeting(this); return false;">
			</map>
		</div>
	</body>
	<script>
	var workingArea = "undefined";
	//Function to display the working area logo
	function setWorkingArea(element){
		
		//Get details from the element passed as a parameter
		var title = element.getAttribute("title");
		var coordString = element.getAttribute("coords");
		
		//Get the icon and text elements
		var workingAreaIcon = document.getElementById("workingArea");
		var workingAreaText = document.getElementById("workingAreaText");
		
		//Split the coords so we can use each individual one
		var coords = coordString.split(",");

		//Show the icon, and move it to our coordinates
		workingAreaIcon.style.display = "block";
		workingAreaIcon.style.left = coords[0]+"px";
		workingAreaIcon.style.top = coords[1]+"px";
		
		//Set the content of the working area text to where the user clicked
		workingAreaText.innerHTML = "You are working in: " + title;
		workingArea = title;
		
		//run pathing from start
		findNearestPoint(coordString);
	}
	
	//Old function used to draw on the canvas where the user clicked (issues with coordinate inconsitency)
	function changeColorOfArea(x1, y1){
		var canvas = document.getElementById("firstFloorCanvas");
		var context = canvas.getContext("2d");		
		context.fillStyle = "GREEN";
		context.fillRect(x1, y1, 30, 10);		
	}
	//Next step is adding way points at all key intersection areas
	//These way points will all add up to create a path (starting point -> waypoint 1 -> waypoint 2 -> meeting room)
	//Waypoints are placed wherever there is a choice to be made
	
	function drawLineToMeeting(element){
		if(workingArea === "undefined"){
			alert("Please select your working area first.")
		}
		else{
			var workingAreaIcon = document.getElementById("workingArea");
			var originX = workingAreaIcon.offsetLeft;
			var originY = workingAreaIcon.offsetTop;
			var coordString = element.getAttribute("coords");
			var coords = coordString.split(",");
			var canvas = document.getElementById("firstFloorCanvas");
			var context = canvas.getContext("2d");
			var coordString = element.getAttribute("coords");
		
			//Get the icon
			var meetingAreaIcon = document.getElementById("meetingArea");			

			//Show the icon, and move it to our coordinates
			meetingAreaIcon.style.display = "block";
			meetingAreaIcon.style.left = coords[0]+"px";
			meetingAreaIcon.style.top = coords[1]+"px";
			
			//draw a line			
			context.moveTo(coords[0],coords[1]);
			context.lineTo(originX,originY);
			context.strokeStyle = "green";
			context.lineWidth = 5;
			context.stroke();
		}
	}
	
	function findNearestPoint(start){
		var canvas = document.getElementById("firstFloorCanvas");		
		var context = canvas.getContext("2d");
		
		//Set our waypoints based on image-map manual point generation
		var waypoints = ["559,230","557,277","488,272","419,271","367,273","319,276","282,305","225,304","97,310","324,323","336,374","556,334","472,333","420,332","553,371","558,482","556,555","554,624","556,702"];
		var end = [475, 437];
		
		//Set lowestCost and bestMove to null as they havent been found yet
		var lowestCost = null;
		var bestMove = null;
		
		//Create a list for the coordinates we have already used
		var closed = [];
		
		//Use i counter to allow the algorithm to run 5 times (overshoots meeting rooms if they are less than 5 steps away)
		var i = 0;
		while(i <= 5){
		
			//Loop through the waypoints
			for (x of waypoints){
			
				//If the current waypoint isn't our starting point, and hasn't already been used - possibly redundant having the x != start
				if( x != start && !closed.includes(x)){
				
					//Split our strings to get the numerical coordinates
					var XCoords = x.split(",");
					var startCoords = start.split(",");
					
					//Get the distance from start to the current waypoint
					var startToX = findDistance(startCoords, XCoords);
					
					//Get the distance from the current waypoint to the goal
					var xToGoal = findDistance(XCoords, end);
					
					//Add the distances to get a total distance from our starting point through our current waypoint and to the goal
					var totalDistance = parseInt(xToGoal) + parseInt(startToX);
					
					//If the lowestCost hasn't been set yet, set the best move and lowest amount to our current waypoint
					if(lowestCost == null){
						lowestCost = totalDistance;
						bestMove = x;
					}
					
					//If the lowestCost was already set then check to see if our total distance is less than the lowest distance
					else{
						if (totalDistance < lowestCost){
							lowestCost = totalDistance;
							bestMove = x;
						}						
					}
				}
			}
			//Draw a line from our starting point to the best waypoint
			var origin = start.split(",");
			var coords = bestMove.split(",");
			context.moveTo(origin[0],origin[1]);
			context.lineTo(coords[0],coords[1]);
			
			//Set our next starting move as the current best move
			start = bestMove;
			
			//Add our current waypoint to the list of used waypoints
			closed.push(bestMove);
			
			//Set our lowest cost back to null for the next iteration of the loop
			lowestCost = null;
			
			//Increment i for looping
			i = i + 1;
		}
		
		//Various context style settings
		context.strokeStyle = "green";
		context.lineWidth = 5;
		context.stroke();
	}
	
	//Use the distance formula return the distance between two points
	function findDistance(start, coords){		
		var distance = Math.sqrt( Math.pow((start[0]-coords[0]), 2) + Math.pow((coords[1]-start[1]), 2) );
		//console.log("distance:",distance);
		return distance;
	}
	</script>
</html>
